<table mat-table [dataSource]="this.rows" class="mat-elevation-z8 basic-margin">

  <!--- Note that these columns can be defined in any order.
        The actual rendered columns are set as a property on the row definition" -->

  <!-- First header  and rows-->
  <ng-container *ngFor="let header of headers[0]; let i = index; let first = first; let last = last" 
  [matColumnDef]="header.code"
  >
    <th mat-header-cell *matHeaderCellDef [ngStyle]=" header.code === 'user' ? {'display': 'none'} : {}"> 
      {{header.code}} 
    </th>

    <td mat-cell *matCellDef="let element" 
    [attr.rowspan]="i === 0 ? 2 : 1"
    [attr.colspan]="getRowSpan(element, i, header.code, first, last)"
    [ngStyle]="getRowSpan(element, i, header.code, first, last) === 0 ? {'display':'none'} : {}"
    [ngClass]="element[header.code].category"
    >
      {{this.getTimeSlotDisplayValue(element, header.code)}}
    </td>
  </ng-container>

<!-- Second Headers -->
  <ng-container *ngFor="let secondHeader of headers[1]" [matColumnDef]="secondHeader.code">
    <th mat-header-cell *matHeaderCellDef 
    [attr.colSpan]="secondHeader.colSpan"
    [ngStyle]=" secondHeader.code === 'user2' ? {'display': 'none'} : {}"> {{secondHeader.code}} </th>
  </ng-container>

<!-- Third headers -->
  <ng-container *ngFor="let thirdHeader of headers[2]; let i = index" [matColumnDef]="thirdHeader.code">
    <th mat-header-cell *matHeaderCellDef 
      [attr.colSpan]="thirdHeader.colSpan" 
      [attr.rowspan]="thirdHeader.code === 'user3' ? 3 : 1"> 
      {{thirdHeader.code}} 
    </th>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="this.thirdHeadersList; sticky: true"></tr>
  <tr mat-header-row *matHeaderRowDef="this.secondHeadersList; sticky: true"></tr>
  <tr mat-header-row *matHeaderRowDef="this.firstHeadersList; sticky: true"></tr>

  <tr mat-row *matRowDef="let row; columns: this.firstHeadersList;"></tr>
</table>